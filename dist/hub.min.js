/**
 * scania-cross-storage - Cross domain localStorage, indexedDB and WebSQL using localforage
 *
 * @version   2.0.0
 * @link      https://github.com/mohammed-softordi/cross-storage
 * @author    Mohammed Ayowa <mohammed.ayowa@scania.com>
 * @copyright Zendesk
 * @license   Apache-2.0
 */

!function(e){var n={};n.init=function(e,t){var r=!0;try{t||(r=!1)}catch(o){r=!1}if(!r)try{return window.parent.postMessage("cross-storage:unavailable","*")}catch(o){return}localforage.config(t),n._permissions=e||[],n._installListener(),window.parent.postMessage("cross-storage:ready","*")},n._installListener=function(){var e=n._listener;window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent("onmessage",e)},n._listener=function(e){var t,r,o,i,s,a;if(t="null"===e.origin?"file://":e.origin,"cross-storage:poll"===e.data)return window.parent.postMessage("cross-storage:ready",e.origin);if("cross-storage:ready"!==e.data){try{o=JSON.parse(e.data)}catch(f){return}o&&"string"==typeof o.method&&(i=o.method.split("cross-storage:")[1],i&&(n._permitted(t,i)?n["_"+i](o.params).then(function(e){a=JSON.stringify({id:o.id,result:e}),r="file://"===t?"*":t,window.parent.postMessage(a,r)}).catch(function(e){a=JSON.stringify({id:o.id,error:e}),r="file://"===t?"*":t,window.parent.postMessage(a,r)}):s="Invalid permissions for "+i))}},n._permitted=function(e,t){var r,o,i,s;if(r=["get","set","del","clear","getKeys"],!n._inArray(t,r))return!1;for(o=0;o<n._permissions.length;o++)if(i=n._permissions[o],i.origin instanceof RegExp&&i.allow instanceof Array&&(s=i.origin.test(e),s&&n._inArray(t,i.allow)))return!0;return!1},n._set=function(e){localforage.setItem(e.key,e.value,console.log)},n._get=function(e){return localforage.getItem(e.key)},n._del=function(e){for(var n=0;n<e.keys.length;n++)localforage.removeItem(e.keys[n],console.log)},n._clear=function(){localforage.clear()},n._getKeys=function(){var e,n;return n=[],localforage.length().then(function(t){for(e=0;t>e;e++)localforage.key(e,function(e){n.push(e)})}).catch(function(e){console.log(e)}),n},n._inArray=function(e,n){for(var t=0;t<n.length;t++)if(e===n[t])return!0;return!1},n._now=function(){return"function"==typeof Date.now?Date.now():(new Date).getTime()},"undefined"!=typeof module&&module.exports?module.exports=n:"undefined"!=typeof exports?exports.CrossStorageHub=n:"function"==typeof define&&define.amd?define([],function(){return n}):e.CrossStorageHub=n}(this);